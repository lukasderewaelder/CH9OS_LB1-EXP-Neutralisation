<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Säure-Base Auswahl (3 Molar)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9;
            user-select: none;
        }

        /* Bubbles animation */
        .bubbles {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none;
            z-index: 10;
        }
        
        .bubble {
            position: absolute;
            bottom: -10px;
            background-color: rgba(255, 255, 255, 0.4);
            border-radius: 50%;
            animation: rise 2s infinite ease-in;
        }

        @keyframes rise {
            0% { bottom: -10px; transform: translateX(0); opacity: 0; }
            50% { opacity: 0.6; }
            100% { bottom: 100%; transform: translateX(-15px); opacity: 0; }
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .liquid-transition {
            transition: height 0.3s ease-out, background-color 1.0s ease;
        }

        select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem;
            -webkit-appearance: none;
            appearance: none;
        }

        /* Beaker Specifics */
        .beaker-glass {
            background: linear-gradient(90deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 20%, rgba(255,255,255,0.05) 80%, rgba(255,255,255,0.1) 100%);
            border-left: 3px solid rgba(255,255,255,0.4);
            border-right: 3px solid rgba(255,255,255,0.4);
            border-bottom: 5px solid rgba(255,255,255,0.4);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1), inset 0 0 20px rgba(255,255,255,0.2);
        }

        .beaker-rim {
            border: 3px solid rgba(255,255,255,0.5);
            background: rgba(255,255,255,0.1);
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center py-6 px-4 text-slate-800">

    <header class="mb-6 max-w-4xl">
        <h1 class="text-center text-3xl font-bold text-slate-800 mb-1 tracking-tight">Experiment: Säuren und Basen</h1>
        <p class="text-left text-sm text-slate-500">Wähle die Chemikalien aus. <br>Beobachte, was den pH-Wert und die Temperatur bei der Reaktion einer Säure und einer Base. <br> Teste verschiedene Kombinationen an Säuren und Basen. Was fällt dir auf, wenn du gleiche Mengen Natonlauge und Schwefelsäure reagieren lassen möchtest?</p>
    </header>

    <main class="w-full max-w-7xl grid grid-cols-1 lg:grid-cols-12 gap-6 items-start">
        
        <!-- Left Column: Controls -->
        <div class="lg:col-span-3 space-y-4">
            
            <!-- Acid Selection & Controls -->
            <div class="glass-panel p-4 rounded-xl border-l-4 border-red-500 shadow-sm transition">
                <label class="text-xs font-bold text-red-600 uppercase tracking-wider mb-1 block">Wähle Säure (3M)</label>
                <select id="acid-select" class="w-full mb-3 bg-red-50 border border-red-200 text-slate-700 text-sm rounded-lg focus:ring-red-500 focus:border-red-500 block p-2.5 font-semibold">
                    <option value="hcl">Salzsäure (HCl)</option>
                    <option value="h2so4">Schwefelsäure (H₂SO₄)</option>
                    <option value="h3po4">Phosphorsäure (H₃PO₄)</option>
                    <option value="ch3cooh">Essigsäure (CH₃COOH)</option>
                </select>

                <div class="grid grid-cols-3 gap-2">
                    <button onclick="addAcid(1)" class="bg-white hover:bg-red-50 border border-red-100 text-red-600 py-2 rounded text-xs font-bold active:scale-95 transition">+1 ml</button>
                    <button onclick="addAcid(10)" class="bg-white hover:bg-red-50 border border-red-100 text-red-600 py-2 rounded text-xs font-bold active:scale-95 transition">+10 ml</button>
                    <button onclick="addAcid(50)" class="bg-red-50 hover:bg-red-100 border border-red-200 text-red-700 py-2 rounded text-xs font-bold active:scale-95 transition">+50 ml</button>
                </div>
            </div>

            <!-- Base Selection & Controls -->
            <div class="glass-panel p-4 rounded-xl border-l-4 border-blue-500 shadow-sm transition">
                <label class="text-xs font-bold text-blue-600 uppercase tracking-wider mb-1 block">Wähle Lauge (3M)</label>
                <select id="base-select" class="w-full mb-3 bg-blue-50 border border-blue-200 text-slate-700 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5 font-semibold">
                    <option value="naoh">Natronlauge (NaOH)</option>
                    <option value="caoh2">Calciumhydroxid (Ca(OH)₂)</option>
                    <option value="koh">Kaliumhydroxid (KOH)</option>
                </select>

                <div class="grid grid-cols-3 gap-2">
                    <button onclick="addBase(1)" class="bg-white hover:bg-blue-50 border border-blue-100 text-blue-600 py-2 rounded text-xs font-bold active:scale-95 transition">+1 ml</button>
                    <button onclick="addBase(10)" class="bg-white hover:bg-blue-50 border border-blue-100 text-blue-600 py-2 rounded text-xs font-bold active:scale-95 transition">+10 ml</button>
                    <button onclick="addBase(50)" class="bg-blue-50 hover:bg-blue-100 border border-blue-200 text-blue-700 py-2 rounded text-xs font-bold active:scale-95 transition">+50 ml</button>
                </div>
            </div>

            <!-- Water Controls -->
            <div class="glass-panel p-4 rounded-xl border-l-4 border-cyan-400 shadow-sm transition">
                <h2 class="font-bold text-sm mb-2 flex justify-between items-center text-cyan-700">
                    Wasser (Destilliert)
                </h2>
                <div class="grid grid-cols-3 gap-2">
                    <button onclick="addWater(10)" class="bg-white hover:bg-cyan-50 border border-cyan-100 text-cyan-600 py-2 rounded text-xs font-bold active:scale-95 transition">+10 ml</button>
                    <button onclick="addWater(50)" class="bg-white hover:bg-cyan-50 border border-cyan-100 text-cyan-600 py-2 rounded text-xs font-bold active:scale-95 transition">+50 ml</button>
                    <button onclick="addWater(100)" class="bg-cyan-50 hover:bg-cyan-100 border border-cyan-200 text-cyan-700 py-2 rounded text-xs font-bold active:scale-95 transition">+100 ml</button>
                </div>
                <p class="text-[10px] text-gray-400 mt-2 italic">Verdünnt die Lösung.</p>
            </div>

            <!-- Reset -->
            <button onclick="resetSim()" class="w-full bg-slate-200 hover:bg-slate-300 text-slate-600 font-bold py-3 px-4 rounded-xl transition flex items-center justify-center gap-2 text-sm">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12"/></svg>
                Becherglas leeren
            </button>
        </div>

        <!-- Center Column: Visual Simulation -->
        <div class="lg:col-span-5 flex flex-col items-center justify-end relative h-[650px] glass-panel rounded-3xl p-6 shadow-xl border-t border-white">
            
            <!-- Sensor Heads (Digital) -->
            <div class="absolute top-6 left-1/2 transform -translate-x-1/2 flex gap-2 z-30">
                <!-- pH Sensor -->
                <div class="bg-slate-800 text-white p-3 rounded-lg shadow-lg border border-slate-600 min-w-[90px] text-center">
                    <div class="text-[9px] text-slate-400 uppercase font-bold tracking-wider">pH-Wert</div>
                    <div class="font-mono text-xl" id="ph-display-main">7.00</div>
                </div>
            </div>

            <!-- Rods for pH Probe -->
            <div class="absolute top-[85px] left-[55%] w-1.5 h-[450px] bg-gray-300 rounded-b-full z-20 border border-gray-400">
                <div class="absolute bottom-0 -left-1.5 w-4 h-6 bg-blue-900/50 rounded-full border border-gray-500 backdrop-blur-sm"></div>
            </div>

            <!-- Realistic Beaker -->
            <div class="relative w-64 h-[440px] z-10 mx-auto mt-auto">
                
                <!-- Rim (Opening) -->
                <div class="absolute -top-3 left-0 w-full h-8 beaker-rim rounded-[50%] z-20"></div>
                
                <!-- Glass Body -->
                <div class="absolute top-0 left-0 w-full h-full beaker-glass rounded-b-[3rem] overflow-hidden z-10">
                    
                    <!-- Liquid Container -->
                    <div id="liquid" class="absolute bottom-0 left-0 w-full liquid-transition flex items-end justify-center" style="height: 0%; background-color: #f1f5f9;">
                        <!-- Surface Meniscus -->
                        <div class="absolute top-0 w-full h-4 bg-white/20 rounded-[50%] -translate-y-1/2 scale-x-105 blur-[1px]"></div>
                        <div id="bubbles-container" class="bubbles"></div>
                    </div>

                    <!-- Ticks / Graduations -->
                    <div class="absolute right-0 top-[15%] w-6 h-px bg-slate-400/60"></div>
                    <div class="absolute right-2 top-[15%] text-[10px] text-slate-500 font-mono -mt-3">1000</div>
                    
                    <div class="absolute right-0 top-[35%] w-4 h-px bg-slate-400/40"></div>
                    <div class="absolute right-0 top-[55%] w-6 h-px bg-slate-400/60"></div>
                    <div class="absolute right-2 top-[55%] text-[10px] text-slate-500 font-mono -mt-3">500</div>
                    
                    <div class="absolute right-0 top-[75%] w-4 h-px bg-slate-400/40"></div>

                    <!-- Highlight / Reflection -->
                    <div class="absolute top-0 left-4 w-4 h-[90%] bg-gradient-to-b from-white/30 to-transparent rounded-full blur-[2px]"></div>
                </div>

                <!-- Rim (Back part for depth, behind liquid) -->
                <div class="absolute -top-3 left-0 w-full h-8 border-t-2 border-slate-300/30 rounded-[50%] z-0"></div>
            </div>
            
            <!-- Stirrer -->
            <div class="w-72 h-4 bg-slate-300 rounded-full mt-4 blur-sm opacity-60"></div>
            <div class="mt-2 text-xs text-gray-400 font-mono tracking-widest uppercase">Magnetrührer aktiv</div>
        </div>

        <!-- Right Column: Graphs & Data -->
        <div class="lg:col-span-4 space-y-4">
            
            <!-- Spectrum Scale -->
            <div class="glass-panel p-4 rounded-xl">
                <h3 class="text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">Farbe (Indikator)</h3>
                <div class="h-8 w-full rounded-md shadow-inner relative overflow-hidden" 
                     style="background: linear-gradient(to right, 
                     #ef4444 0%,   
                     #f97316 25%,   
                     #eab308 40%,  
                     #22c55e 50%,   
                     #06b6d4 60%,   
                     #3b82f6 75%,   
                     #6366f1 100%);">
                     <div id="ph-marker" class="absolute top-0 bottom-0 w-1.5 bg-white border border-slate-900 shadow-xl transition-all duration-500 ease-out" style="left: 50%;"></div>
                </div>
                <div class="flex justify-between mt-2">
                    <span id="indicator-text" class="text-sm font-bold ml-auto mr-auto px-3 py-1 rounded bg-slate-100 shadow-sm">Neutral</span>
                </div>
            </div>

            <!-- Realistic Thermometer -->
            <div class="glass-panel p-6 rounded-xl flex items-center gap-4">
                <div class="flex-1">
                    <h3 class="text-xs font-bold text-slate-500 uppercase tracking-wider mb-1">Temperatur</h3>
                    <div class="text-3xl font-mono text-slate-700 font-bold" id="temp-display-text">20.0°C</div>
                    <p class="text-[10px] text-gray-400 mt-1">Reaktionswärme (exotherm)</p>
                </div>
                
                <!-- Thermometer Visual -->
                <div class="relative h-48 w-14 flex-shrink-0">
                    <!-- Glass Stem -->
                    <div class="absolute left-1/2 -translate-x-1/2 top-0 bottom-0 w-4 bg-slate-100 rounded-t-full border border-slate-300 shadow-[inset_1px_0_3px_rgba(0,0,0,0.1)] z-10 overflow-hidden">
                        <!-- Ticks inside stem -->
                        <div class="w-full h-full opacity-30 bg-[repeating-linear-gradient(0deg,transparent,transparent_19px,#000_20px)]"></div>
                    </div>
                    
                    <!-- Liquid Column (Red) -->
                    <div class="absolute left-1/2 -translate-x-1/2 bottom-[24px] w-2 bg-red-600 transition-all duration-500 ease-out z-20 rounded-t-full" id="temp-column" style="height: 0%"></div>
                    
                    <!-- Bulb -->
                    <div class="absolute bottom-0 left-1/2 -translate-x-1/2 w-8 h-8 bg-red-600 rounded-full border border-slate-300 shadow-md z-30 flex items-center justify-center radial-gradient(circle at 30% 30%, white, red)">
                        <div class="w-2 h-2 bg-white/40 rounded-full absolute top-2 left-2 blur-[1px]"></div>
                    </div>

                    <!-- Marks (Right Side) -->
                    <div class="absolute right-0 top-0 h-[calc(100%-2rem)] w-1/2 flex flex-col justify-between py-1 text-[9px] text-slate-400 font-mono">
                        <span class="flex items-center justify-end w-full gap-1">60°<span class="w-2 h-px bg-slate-400"></span></span>
                        <span class="flex items-center justify-end w-full gap-1"><span class="w-1 h-px bg-slate-300"></span></span>
                        <span class="flex items-center justify-end w-full gap-1">40°<span class="w-2 h-px bg-slate-400"></span></span>
                        <span class="flex items-center justify-end w-full gap-1"><span class="w-1 h-px bg-slate-300"></span></span>
                        <span class="flex items-center justify-end w-full gap-1">20°<span class="w-2 h-px bg-slate-400"></span></span>
                    </div>
                </div>
            </div>

            <!-- Data Table -->
            <div class="glass-panel rounded-xl overflow-hidden border border-slate-200">
                <table class="w-full text-xs text-left">
                    <thead class="bg-slate-100 text-slate-500 uppercase">
                        <tr>
                            <th class="p-2 font-semibold">Stoff (3M)</th>
                            <th class="p-2 font-semibold text-right">Vol</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-slate-100" id="substance-table-body">
                        <tr id="row-hcl" class="hidden">
                            <td class="p-1 pl-3 text-slate-600">Salzsäure (HCl)</td>
                            <td class="p-1 pr-3 text-right font-mono" id="vol-hcl">0 ml</td>
                        </tr>
                        <tr id="row-h2so4" class="hidden">
                            <td class="p-1 pl-3 text-slate-600">Schwefelsäure (H₂SO₄)</td>
                            <td class="p-1 pr-3 text-right font-mono" id="vol-h2so4">0 ml</td>
                        </tr>
                        <tr id="row-h3po4" class="hidden">
                            <td class="p-1 pl-3 text-slate-600">Phosphorsäure (H₃PO₄)</td>
                            <td class="p-1 pr-3 text-right font-mono" id="vol-h3po4">0 ml</td>
                        </tr>
                        <tr id="row-ch3cooh" class="hidden">
                            <td class="p-1 pl-3 text-slate-600">Essigsäure (CH₃COOH)</td>
                            <td class="p-1 pr-3 text-right font-mono" id="vol-ch3cooh">0 ml</td>
                        </tr>
                        <tr id="row-naoh" class="hidden">
                            <td class="p-1 pl-3 text-slate-600">Natronlauge (NaOH)</td>
                            <td class="p-1 pr-3 text-right font-mono" id="vol-naoh">0 ml</td>
                        </tr>
                        <tr id="row-koh" class="hidden">
                            <td class="p-1 pl-3 text-slate-600">Kaliumhydroxid (KOH)</td>
                            <td class="p-1 pr-3 text-right font-mono" id="vol-koh">0 ml</td>
                        </tr>
                        <tr id="row-caoh2" class="hidden">
                            <td class="p-1 pl-3 text-slate-600">Calciumhydroxid (Ca(OH)₂)</td>
                            <td class="p-1 pr-3 text-right font-mono" id="vol-caoh2">0 ml</td>
                        </tr>
                        <tr id="row-water" class="hidden bg-cyan-50/50">
                            <td class="p-1 pl-3 text-cyan-700">Wasser</td>
                            <td class="p-1 pr-3 text-right font-mono" id="vol-water">0 ml</td>
                        </tr>
                        <tr class="bg-slate-50 font-bold">
                            <td class="p-2 pl-3 text-slate-800">Gesamt</td>
                            <td class="p-2 pr-3 text-right font-mono" id="vol-total">0 ml</td>
                        </tr>
                    </tbody>
                </table>
                <div id="empty-msg" class="text-center p-4 text-gray-400 italic text-[10px]">Becherglas leer</div>
            </div>

        </div>
    </main>

    <script>
        // --- State Variables (Individual tracking) ---
        let volHCl = 0; 
        let volH2SO4 = 0;
        let volH3PO4 = 0;
        let volCH3COOH = 0;
        
        let volNaOH = 0;
        let volCaOH2 = 0;
        let volKOH = 0;
        
        let volWater = 0;
        
        // --- KONZENTRATION ---
        // 3.0 Molar für starke Reaktion
        const CONC = 3.0; 
        
        // Physics constants
        const BASE_TEMP = 20.0;
        const HEAT_OF_NEUTRALIZATION = 57300; // J/mol
        const SPECIFIC_HEAT = 4.18; 
        
        // Animation State
        let currentDisplayedTemp = 20.0;
        let targetTemp = 20.0;
        let lastTimestamp = 0;
        
        function addAcid(amount) {
            const type = document.getElementById('acid-select').value;
            if (getTotalVol() + amount > 1000) return;

            if (type === 'hcl') volHCl += amount;
            if (type === 'h2so4') volH2SO4 += amount;
            if (type === 'h3po4') volH3PO4 += amount;
            if (type === 'ch3cooh') volCH3COOH += amount;
            
            triggerReaction(amount);
            recalculatePhysics();
        }

        function addBase(amount) {
            const type = document.getElementById('base-select').value;
            if (getTotalVol() + amount > 1000) return;

            if (type === 'naoh') volNaOH += amount;
            if (type === 'caoh2') volCaOH2 += amount;
            if (type === 'koh') volKOH += amount;

            triggerReaction(amount);
            recalculatePhysics();
        }

        function addWater(amount) {
            if (getTotalVol() + amount > 1000) return;
            volWater += amount;
            recalculatePhysics();
        }

        function getTotalVol() {
            return volHCl + volH2SO4 + volH3PO4 + volCH3COOH + 
                   volNaOH + volCaOH2 + volKOH + 
                   volWater;
        }

        function triggerReaction(amount) {
            const totalAcid = volHCl + volH2SO4 + volH3PO4 + volCH3COOH;
            const totalBase = volNaOH + volCaOH2 + volKOH;
            
            if (totalAcid > 0 && totalBase > 0) {
                 createBubbles(Math.min(15, amount));
            }
        }

        function recalculatePhysics() {
            const totalVol = getTotalVol();
            
            if (totalVol === 0) {
                updateUI(7, 20, '#f1f5f9');
                updateTableVisibility();
                return;
            }

            // --- 1. Moles Calculation (Stoichiometry) ---
            const molesH = (
                volHCl * CONC * 1 + 
                volH2SO4 * CONC * 2 + 
                volH3PO4 * CONC * 3 + 
                volCH3COOH * CONC * 1
            ) / 1000;

            const molesOH = (
                volNaOH * CONC * 1 + 
                volCaOH2 * CONC * 2 + 
                volKOH * CONC * 1
            ) / 1000;
            
            // --- 2. pH Calculation ---
            let ph = 7.0;
            const excessMoles = molesH - molesOH;

            if (Math.abs(excessMoles) < 1e-9) { 
                ph = 7.0;
            } else if (excessMoles > 0) {
                const concH = excessMoles / (totalVol / 1000);
                ph = -Math.log10(concH);
            } else {
                const concOH = Math.abs(excessMoles) / (totalVol / 1000);
                const pOH = -Math.log10(concOH);
                ph = 14 - pOH;
            }
            ph = Math.max(0, Math.min(14, ph));

            // --- 3. Temperature Calculation ---
            const molesReacted = Math.min(molesH, molesOH);
            const energyReleasedJ = molesReacted * HEAT_OF_NEUTRALIZATION; 
            const totalMassG = totalVol; 
            
            const tempRise = energyReleasedJ / (totalMassG * SPECIFIC_HEAT);
            targetTemp = BASE_TEMP + tempRise;

            // --- 4. Update UI ---
            const color = getClassicIndicatorColor(ph);
            updateInstantUI(ph, color, totalVol);
        }

        function getClassicIndicatorColor(ph) {
            if (ph < 3.0) return '#ef4444'; // Red
            if (ph < 5.0) return '#f97316'; // Orange
            if (ph < 6.5) return '#eab308'; // Yellow
            if (ph >= 6.5 && ph <= 7.5) return '#22c55e'; // Green
            if (ph < 9.0) return '#06b6d4'; // Cyan
            if (ph < 11.0) return '#3b82f6'; // Blue
            return '#6366f1'; // Violet
        }

        function getIndicatorName(ph) {
            if (ph < 3) return 'Stark Sauer';
            if (ph < 6) return 'Sauer';
            if (ph >= 6 && ph <= 8) return 'Neutral';
            if (ph < 11) return 'Basisch';
            return 'Stark Basisch';
        }

        function updateInstantUI(ph, color, volume) {
            const heightPercent = Math.min((volume / 1000) * 100, 98);
            const liquid = document.getElementById('liquid');
            liquid.style.height = `${heightPercent}%`;
            liquid.style.backgroundColor = color;

            const phDisplay = document.getElementById('ph-display-main');
            phDisplay.innerText = ph.toFixed(2);
            phDisplay.style.color = (ph > 6.8 && ph < 7.2) ? '#22c55e' : color;

            const marker = document.getElementById('ph-marker');
            marker.style.left = `${(ph / 14) * 100}%`;

            const textLabel = document.getElementById('indicator-text');
            textLabel.innerText = getIndicatorName(ph);
            textLabel.style.color = color;
            textLabel.style.backgroundColor = 'rgba(255,255,255,0.8)';

            updateTableVisibility();
            
            document.getElementById('vol-hcl').innerText = `${volHCl} ml`;
            document.getElementById('vol-h2so4').innerText = `${volH2SO4} ml`;
            document.getElementById('vol-h3po4').innerText = `${volH3PO4} ml`;
            document.getElementById('vol-ch3cooh').innerText = `${volCH3COOH} ml`;
            
            document.getElementById('vol-naoh').innerText = `${volNaOH} ml`;
            document.getElementById('vol-caoh2').innerText = `${volCaOH2} ml`;
            document.getElementById('vol-koh').innerText = `${volKOH} ml`;
            
            document.getElementById('vol-water').innerText = `${volWater} ml`;
            document.getElementById('vol-total').innerText = `${volume} ml`;
        }
        
        function updateTableVisibility() {
            const rows = [
                {id: 'row-hcl', val: volHCl},
                {id: 'row-h2so4', val: volH2SO4},
                {id: 'row-h3po4', val: volH3PO4},
                {id: 'row-ch3cooh', val: volCH3COOH},
                {id: 'row-naoh', val: volNaOH},
                {id: 'row-koh', val: volKOH},
                {id: 'row-caoh2', val: volCaOH2},
                {id: 'row-water', val: volWater}
            ];
            
            let anyVisible = false;
            rows.forEach(r => {
                const el = document.getElementById(r.id);
                if(r.val > 0) {
                    el.classList.remove('hidden');
                    anyVisible = true;
                } else {
                    el.classList.add('hidden');
                }
            });
            
            const emptyMsg = document.getElementById('empty-msg');
            if(anyVisible) {
                emptyMsg.style.display = 'none';
            } else {
                emptyMsg.style.display = 'block';
            }
        }

        // --- Animation Loop ---
        function animateTemp(timestamp) {
            if (!lastTimestamp) lastTimestamp = timestamp;
            
            const diff = targetTemp - currentDisplayedTemp;
            if (Math.abs(diff) > 0.01) {
                currentDisplayedTemp += diff * 0.03; 
            } else {
                currentDisplayedTemp = targetTemp;
            }

            // Update Text (Fixed: Removed the line causing the error)
            const tempDisplayText = document.getElementById('temp-display-text');
            if(tempDisplayText) {
                tempDisplayText.innerText = currentDisplayedTemp.toFixed(1) + "°C";
            }
            
            // ADJUSTED SCALE for 3M (Range 20°C - 60°C)
            const minT = 20.0;
            const maxT = 60.0; 
            let barPct = ((currentDisplayedTemp - minT) / (maxT - minT)) * 100;
            barPct = Math.max(0, Math.min(100, barPct));
            
            // Update New Thermometer
            const tempColumn = document.getElementById('temp-column');
            if(tempColumn) {
                tempColumn.style.height = `${barPct}%`;
                // Keep it strictly red for realism
                tempColumn.style.backgroundColor = '#dc2626'; 
            }

            lastTimestamp = timestamp;
            requestAnimationFrame(animateTemp);
        }

        function createBubbles(count) {
            const container = document.getElementById('bubbles-container');
            for (let i = 0; i < count; i++) {
                const bubble = document.createElement('div');
                bubble.classList.add('bubble');
                bubble.style.left = `${Math.random() * 80 + 10}%`;
                const size = Math.random() * 6 + 4;
                bubble.style.width = `${size}px`;
                bubble.style.height = `${size}px`;
                bubble.style.animationDuration = `${Math.random() * 1.0 + 1.5}s`;
                container.appendChild(bubble);
                setTimeout(() => bubble.remove(), 2500);
            }
        }

        function resetSim() {
            volHCl = 0; volH2SO4 = 0; volH3PO4 = 0; volCH3COOH = 0;
            volNaOH = 0; volCaOH2 = 0; volKOH = 0;
            volWater = 0;
            targetTemp = 20.0;
            
            document.getElementById('liquid').style.height = '0%';
            document.getElementById('liquid').style.backgroundColor = '#f1f5f9';
            updateInstantUI(7.00, '#e2e8f0', 0);
        }

        requestAnimationFrame(animateTemp);
    </script>
</body>
</html>